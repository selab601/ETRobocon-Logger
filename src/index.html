<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>ET2016 EV3 Logger</title>

    <!-- スタイルシート -->
    <link href="css/main.css" rel="stylesheet" type="text/css">

    <!-- 外部のライブラリのロード -->
    <script>
      window.jQuery = window.$ = require('./js/lib/jquery-3.1.0.min.js');
      var d3 = require('./js/lib/d3.min.js');
    </script>

    <script>
      var ipcRenderer = require('electron').ipcRenderer;

      var LogWriter = require('./js/logWriter.js');
      var writer = new LogWriter();

      var D3GraphRenderer = require('./js/D3GraphRenderer.js');
      var renderer;

      $(document).ready(function() {
        // グラフとして見たい値がある場合は以下の配列に追加する
        var renderValues = ["brightness", "gyro"]

        renderer = new D3GraphRenderer(d3, renderValues);

        ipcRenderer.on('serial', (ev, message) => {
          var data = JSON.parse(message);

          // 外部ファイルにログを出力
          writer.append(message);

          // 値の更新
          Object.keys(renderer.getReceiveValues()).forEach(function(key) {
            renderer.update(key, data[key]);
          });

          // 描画
          for (var i=0; i<renderValues.length; i++) {
            renderer.renderDynamicGraph(renderValues[i]);
          }
        });
      });
    </script>
  </head>
  <body>
    <div id="d3graph"></div>
  </body>
</html>
